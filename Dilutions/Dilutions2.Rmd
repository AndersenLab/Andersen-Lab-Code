```{r set-options, echo=FALSE, cache=FALSE}
options(width=200)
```
```{r, echo = FALSE}
#Get the compound name
compound = readRDS("compound.rds")
```
Dilution Sheet for `r compound`
========================================================
```{r, echo=FALSE, warning=FALSE}
#Determine whether a stock needs to be made
stockmake = readRDS("stockmake.rds")
#Get the recipe
recipe = readRDS("recipe.rds")
#See if the stock solution is contrated enough to make any of the dilutions
brake = readRDS("brake.rds")

#Round the recipe columns to pipettable volumes
roundVolume = function(x){
    if(x <= 2){
        return(as.character(round(x,3)))
    } else if(x <= 20){
        return(as.character(round(x,2)))
    } else if(x <= 200){
        return(as.character(round(x,1)))
    } else {
        return(as.character(round(x,0)))
    }    
}

#Get the raw amounts for the lysate and s medium
recipe[,5] = as.numeric(as.character(recipe[,5]))
recipe[,3] = as.numeric(as.character(recipe[,3]))
rawLysate = as.numeric(as.character(5*recipe[1,5]))
rawSmed = as.numeric(as.character(5*recipe[1,3]))

#Adjust for pipetiing error (make a little extra)
adjLysate = rawLysate * (1+(1/60))
tot = adjLysate * 10
adjSmed = tot - adjLysate
slmix = paste(round(adjLysate + adjSmed,0), " ÂµL.")

#Round the recipe values
recipe[,c(3,4,6)] = sapply(recipe[,c(3,4,6)], roundVolume)

#Space out the columns by adding spaces in the column titles
for (i in seq(1,length(recipe))){
  colnames(recipe)[i] = sprintf("%03s",colnames(recipe)[i])
}
```

Make concentrated stock solution:

```{r, echo = FALSE}
stockmake
```

Total the S Medium/Lysate mix:

```{r, echo = FALSE}
slmix
```

Dilute down to final concentrations:

```{r, echo = FALSE}
if (brake == TRUE){
  print("The stock dilution is not concentrated enough.")
}
if (brake == FALSE){
  print(recipe[,c(1,2,3,4,6)])
}
```

Use higher stock (if necessary):

```{r, echo = FALSE}
if (file.exists("highRecipe.rds") == TRUE){
  highRecipe = readRDS("highRecipe.rds")
  highRecipe[,c(3,4,6)] = sapply(highRecipe[,c(3,4,6)], roundVolume)
  print(highRecipe[,c(1,2,3,4,6)])
}
if (file.exists("highRecipe.rds") == FALSE){
  print("Not necessary")
}
```


